{% extends 'website/base.html' %}

{% block title %}{{ block.super }} | Home Page {% endblock title %}
{% block header  %} Main Floor {% endblock header %}
{% block custom_css %}
<style type="text/css">
    table {
        background-color: white;
    }
</style>
{% endblock custom_css %}
{% block contents %}

{% include 'website/nav_bar.html' %}

<div class="container-fluid">
    <br />
    <h1 class="header">Main Floor</h1>
    <div class="row">
        <div class="col-md-8 offset-md-3">
            <table class="table table-striped table-bordered">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th colspan="3">Score</th>
                    </tr>
                </thead>
                <tbody>
                    {% for rushee in rushees|dictsortreversed:"total_score" %}
                    <tr>
                        <td><text class="detail" href="{% url 'website:rushee_detail' pk=rushee.pk %}">{{ rushee.name }}</text></td>
                        <td id='score-{{ rushee.pk }}'>{{ rushee.total_score }}</td>
                          <td>

                        <button class="fa fa-arrow-up vote" value='1' id='{{ rushee.pk }}'></button></td><td><button class="fa fa-arrow-down vote" value='-1' id='{{ rushee.pk }}'></button></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

        </div>

    </div>
</div>

</div>


<div class="modal fade" id="modalLoginForm" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
  aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <form class="comments" name="comments">
          <input type="text" id="pk" name="pk" value="{{ rushee.pk }}">
          {% csrf_token %}
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <label>Comments?</label>
          <input type="text" id="comment" name="comment"></input>
        </div>

        <div class="md-form mb-4">
          <label>Passed to who?</label>
          <input type="text" id="new-brother" name="new-brother"></input>
        </div>

      </div>
      <div class="modal-footer d-flex justify-content-center">
        <button class="btn btn-default modal-submit">Submit</button>
      </div>
      </form>
      </div>
  </div>
</div>


{% endblock contents %}

{% block js %}

<script>

$('.detail').on("click", function(){
    location.replace($(this).attr('href'));
});


$('.vote').on('click', function() {
  let pk = $(this).attr('id')
  let vote = $(this).attr('value')
  $.ajax({
    url: '{% url "website:vote" %}',
    type: 'POST',
    data: {
      csrfmiddlewaretoken: '{{ csrf_token }}',
      vote: vote,
      pk: pk
    },
    dataType: 'json',
    traditional: 'True',
    success: function(data) {
      if (data.success){
          let id = 'score-'  + pk
      document.getElementById(id).innerHTML = data['score'];
      $('#modalLoginForm').modal('toggle');
    }

    else {
      location.reload();
    }
    }
  });
});

$('.modal-submit').on("click", function() {
    let comment = $('input#comment').val();
    let new_brother = $('input#new-brother').val();
    let pk = $('input#pk').val();
    console.log(pk);
    $.ajax({
        url: "{% url 'website:post_vote' %}",
        type: "POST",
        data: {
            'comment': comment,
            'new_brother': new_brother,
            'pk': pk,
            csrfmiddlewaretoken: '{{ csrf_token }}'
        },
        success: function(data) {
        }
    })
})

</script>

{% endblock js %}
