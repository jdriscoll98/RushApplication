{% extends 'website/base.html' %}

{% block title %}{{ block.super }} | Home Page {% endblock title %}
{% block header  %} Main Floor {% endblock header %}
{% block custom_css %}
<style type="text/css">
    table {
        background-color: white;
    }
</style>
{% endblock custom_css %}
{% block contents %}

{% include 'website/nav_bar.html' %}

<div class="container-fluid">
    <br />
    <h1 class="header">Main Floor</h1>
    <div class="row">
        <div class="col-md-8 offset-md-3">
            <table class="table table-striped table-bordered">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th colspan="3">Score</th>
                    </tr>
                </thead>
                <tbody>
                    {% for rushee in rushees %}
                    <tr>
                        <td><text class="detail" href="{% url 'website:rushee_detail' pk=rushee.pk %}">{{ rushee.name }}</text></td>
                        <td id='score-{{ rushee.pk }}'>{{ rushee.total_score }}</td>
                          <td>

                        <button class="fa fa-arrow-up vote" value='1' id='{{ rushee.pk }}'></button></td><td><button class="fa fa-arrow-down vote" value='-1' id='{{ rushee.pk }}'></button></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

        </div>

    </div>

</div>

{% endblock contents %}

{% block js %}

<script>

$('.detail').on("click", function(){
    location.replace($(this).attr('href'));
});


$('.vote').on('click', function() {
  let pk = $(this).attr('id')
  let vote = $(this).attr('value')
  $.ajax({
    url: '{% url "website:vote" %}',
    type: 'POST',
    data: {
      csrfmiddlewaretoken: '{{ csrf_token }}',
      vote: vote,
      pk: pk
    },
    dataType: 'json',
    traditional: 'True',
    success: function(data) {
      if (data.success){
          let id = 'score-'  + pk
      document.getElementById(id).innerHTML = data['score'];
    }
    else {
      location.reload();
    }
    }
  });
});


</script>

{% endblock js %}
